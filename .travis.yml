jobs:
  include:
  - stage: Linux build
    os: linux
    language: python
    sudo: required
    dist: xenial
    python: 3.6
    addons:
      apt:
        packages:
        - tesseract-ocr
        - p7zip-full
    env:
    - PY=python3
  - stage: Windows build
    os: windows
    language: shell
    python: 3.6
    env:
    - PY=py

before_install:
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
    ./scripts/osx_before_install.sh;
  elif  [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
    ./scripts/lin_before_install.sh;
  elif [[ "$TRAVIS_OS_NAME" == "windows" ]]; then
    ./scripts/win_before_install.bat;
  fi

install:
- "$PY -m pip install -r requirements.txt"
- $PY src/_version.py
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
    ./scripts/osx_install.sh;
  elif [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
    ./scripts/lin_install.sh;
  elif [[ "$TRAVIS_OS_NAME" == "windows" ]]; then
    ./scripts/win_install.bat;
  fi

script:
- echo done


before_deploy:
  # Set up git user name and tag this commit
  - git config --local user.name "hallowf"
  - git config --local user.email "$GITHUB_EMAIL"
  - $PY src/_version.py --tag
  - export TRAVIS_TAG=$(<version.txt)
  - git tag $TRAVIS_TAG

deploy:
  provider: releases
  skip_cleanup: true
  api_key: "$DEPLOY_KEY"
  file_glob: true
  file: src/dist/*
  draft: true
  on:
    repo: hallowf/STPDF
